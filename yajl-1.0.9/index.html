<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>YAJL: Yet Another JSON Library (YAJL)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Yet Another JSON Library (YAJL)</h1><h3>1.0.9 </h3><dl class="author"><dt><b>Author:</b></dt><dd>Lloyd Hilaiel </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2007-2009</dd></dl>
<p>Yet Another JSON Library (YAJL) is a small event-driven (SAX-style) JSON parser written in ANSI C, and a small validating JSON generator. YAJL is released under the BSD license.</p>
<h2><a class="anchor" id="features">
Features</a></h2>
<ol type="1">
<li>Stream (incremental) parsing and generation of JSON</li>
<li>ANSI C</li>
<li>Human readable error messages with context</li>
<li>tiny</li>
<li>event driven</li>
<li>support for generating "beautified" JSON</li>
</ol>
<h2><a class="anchor" id="usage">
Usage</a></h2>
<p>The following code sample is a complete JSON "reformating" program. It demonstrates how to perform stream parsing and generation.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;yajl/yajl_parse.h&gt;</span>
<span class="preprocessor">#include &lt;yajl/yajl_gen.h&gt;</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_null(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#a430c1d19322d71298af9870f62b4a771">yajl_gen_null</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_boolean(<span class="keywordtype">void</span> * ctx, <span class="keywordtype">int</span> <span class="keywordtype">boolean</span>)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#af289e0519f7ad7c9523ec9ae0f94ff97">yajl_gen_bool</a>(g, <span class="keywordtype">boolean</span>);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_number(<span class="keywordtype">void</span> * ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> * s, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#a1664d40dc4038ef90476f8218c696c23">yajl_gen_number</a>(g, s, l);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_string(<span class="keywordtype">void</span> * ctx, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * stringVal,
                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stringLen)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#add4fbe27fd9cad440b41dbb9f94a4c0f">yajl_gen_string</a>(g, stringVal, stringLen);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_map_key(<span class="keywordtype">void</span> * ctx, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * stringVal,
                            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stringLen)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#add4fbe27fd9cad440b41dbb9f94a4c0f">yajl_gen_string</a>(g, stringVal, stringLen);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_start_map(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#a3f5c340a31b5af0a1c3f38b505c22691">yajl_gen_map_open</a>(g);
    <span class="keywordflow">return</span> 1;
}


<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_end_map(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#a0cb9e2d38eb8861f91903b3e1832ee09">yajl_gen_map_close</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_start_array(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#a47fa41264cff538c1b6d022dc67ea59e">yajl_gen_array_open</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_end_array(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#a47b2e6e6f095c9fac62cb302629cb266">yajl_gen_array_close</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <a class="code" href="structyajl__callbacks.html">yajl_callbacks</a> callbacks = {
    reformat_null,
    reformat_boolean,
    NULL,
    NULL,
    reformat_number,
    reformat_string,
    reformat_start_map,
    reformat_map_key,
    reformat_end_map,
    reformat_start_array,
    reformat_end_array
};

<span class="keyword">static</span> <span class="keywordtype">void</span>
usage(<span class="keyword">const</span> <span class="keywordtype">char</span> * progname)
{
    fprintf(stderr, <span class="stringliteral">&quot;usage:  %s &lt;filename&gt;\n&quot;</span>
            <span class="stringliteral">&quot;    -m minimize json rather than beautify (default)\n&quot;</span>
            <span class="stringliteral">&quot;    -u allow invalid UTF8 inside strings during parsing\n&quot;</span>,
            progname);
    exit(1);

}

<span class="keywordtype">int</span> 
main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)
{
    <a class="code" href="yajl__parse_8h.html#acb85b92f3d7cb6f0743b4e68d0172323">yajl_handle</a> hand;
    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> fileData[65536];
    <span class="comment">/* generator config */</span>
    <a class="code" href="structyajl__gen__config.html">yajl_gen_config</a> conf = { 1, <span class="stringliteral">&quot;  &quot;</span> };
    <a class="code" href="yajl__gen_8h.html#a497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g;
    <a class="code" href="yajl__parse_8h.html#a1d2bc7f4962c55436daaba61ffaf1f7d">yajl_status</a> stat;
    <span class="keywordtype">size_t</span> rd;
    <span class="comment">/* allow comments */</span>
    <a class="code" href="structyajl__parser__config.html">yajl_parser_config</a> cfg = { 1, 1 };
    <span class="keywordtype">int</span> done = 0;
    
    <span class="comment">/* check arguments.  We expect exactly one! */</span>
    <span class="keywordflow">if</span> (argc == 2) {
        <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;-m&quot;</span>, argv[1])) {
            conf.<a class="code" href="structyajl__gen__config.html#a85437a875ae65161b4f28bac6ff89c99">beautify</a> = 0;

        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">&quot;-u&quot;</span>, argv[1])) {
            cfg.<a class="code" href="structyajl__parser__config.html#a33f7ab7fb27bf626441f15d649dea5d9">checkUTF8</a> = 0;
        } <span class="keywordflow">else</span> {
            usage(argv[0]);
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc != 1) {
        usage(argv[0]);
    }
    
    g = <a class="code" href="yajl__gen_8h.html#a23d15a99325caf8e2029d055d7785b76">yajl_gen_alloc</a>(&amp;conf, NULL);

    <span class="comment">/* ok.  open file.  let&apos;s read and parse */</span>
    hand = <a class="code" href="yajl__parse_8h.html#ab80d9d2cd7a50a9299b7d6a658a3eb7f">yajl_alloc</a>(&amp;callbacks, &amp;cfg, NULL, (<span class="keywordtype">void</span> *) g);
        
    <span class="keywordflow">while</span> (!done) {
        rd = fread((<span class="keywordtype">void</span> *) fileData, 1, <span class="keyword">sizeof</span>(fileData) - 1, stdin);
        
        <span class="keywordflow">if</span> (rd == 0) {
            <span class="keywordflow">if</span> (!feof(stdin)) {
                fprintf(stderr, <span class="stringliteral">&quot;error on file read.\n&quot;</span>);
                <span class="keywordflow">break</span>;
            }
            done = 1;
        }
        fileData[rd] = 0;
        
        <span class="keywordflow">if</span> (done)
            <span class="comment">/* parse any remaining buffered data */</span>
            stat = <a class="code" href="yajl__parse_8h.html#ac348460bb319bcbeb646b542bf150b93">yajl_parse_complete</a>(hand);
        <span class="keywordflow">else</span>
            <span class="comment">/* read file data, pass to parser */</span>
            stat = <a class="code" href="yajl__parse_8h.html#af7fc3bb5b868d2de99624d5a013fca8b">yajl_parse</a>(hand, fileData, rd);

        <span class="keywordflow">if</span> (stat != <a class="code" href="yajl__parse_8h.html#a1d2bc7f4962c55436daaba61ffaf1f7da67a2a1b5d684de357adb0e1ea444ffd7">yajl_status_ok</a> &amp;&amp;
            stat != <a class="code" href="yajl__parse_8h.html#a1d2bc7f4962c55436daaba61ffaf1f7da88c7cd7b308d09c32dad74b47b9ae3f4">yajl_status_insufficient_data</a>)
        {
            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * str = <a class="code" href="yajl__parse_8h.html#ae665f5b192a777b7252edd0a1d4a40e8">yajl_get_error</a>(hand, 1, fileData, rd);
            fprintf(stderr, (<span class="keyword">const</span> <span class="keywordtype">char</span> *) str);
            <a class="code" href="yajl__parse_8h.html#ab752a2010e051cbef8169935b1476017">yajl_free_error</a>(hand, str);
        } <span class="keywordflow">else</span> {
            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * buf;
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len;
            <a class="code" href="yajl__gen_8h.html#ae59a572028ef98b3aff11802b1583712">yajl_gen_get_buf</a>(g, &amp;buf, &amp;len);
            fwrite(buf, 1, len, stdout);
            <a class="code" href="yajl__gen_8h.html#a2e8267e496446a517948952f6f1ef3cb">yajl_gen_clear</a>(g);
        }
    }

    <a class="code" href="yajl__gen_8h.html#a4546ceff8f26e209a79d875ab40fe808">yajl_gen_free</a>(g);
    <a class="code" href="yajl__parse_8h.html#a17a804d07aa6cb03c047096df4b2e866">yajl_free</a>(hand);
    
    <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Fri Jan 8 10:14:26 2010 for YAJL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
