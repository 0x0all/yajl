<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>YAJL: Yet Another JSON Library (YAJL)</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Yet Another JSON Library (YAJL)</h1>
<p>
<h3 align="center">1.0.4 </h3><dl class="author" compact><dt><b>Author:</b></dt><dd>Lloyd Hilaiel </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>2007-2009</dd></dl>
Yet Another JSON Library (YAJL) is a small event-driven (SAX-style) JSON parser written in ANSI C, and a small validating JSON generator. YAJL is released under the BSD license.<h2><a class="anchor" name="features">
Features</a></h2>
<ol type=1>
<li>Stream (incremental) parsing and generation of JSON</li><li>ANSI C</li><li>Human readable error messages with context</li><li>tiny</li><li>event driven</li><li>support for generating "beautified" JSON</li></ol>
<h2><a class="anchor" name="usage">
Usage</a></h2>
The following code sample is a complete JSON "reformating" program. It demonstrates how to perform stream parsing and generation.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;yajl/yajl_parse.h&gt;</span>
<span class="preprocessor">#include &lt;yajl/yajl_gen.h&gt;</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_null(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#401c6129f8795282b25c42ee2d237b87">yajl_gen_null</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_boolean(<span class="keywordtype">void</span> * ctx, <span class="keywordtype">int</span> <span class="keywordtype">boolean</span>)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#eeddc0d51e9ed8677b095a29c0d9188c">yajl_gen_bool</a>(g, <span class="keywordtype">boolean</span>);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_number(<span class="keywordtype">void</span> * ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> * s, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#ffb2162bb74551e60d929ccdaf5c78ae">yajl_gen_number</a>(g, s, l);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_string(<span class="keywordtype">void</span> * ctx, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * stringVal,
                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stringLen)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#605eb8315984fc085954ae9eaea44b03">yajl_gen_string</a>(g, stringVal, stringLen);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_map_key(<span class="keywordtype">void</span> * ctx, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * stringVal,
                            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stringLen)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#605eb8315984fc085954ae9eaea44b03">yajl_gen_string</a>(g, stringVal, stringLen);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_start_map(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#c1e69981f307b64316c9a9a8c186c465">yajl_gen_map_open</a>(g);
    <span class="keywordflow">return</span> 1;
}


<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_end_map(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#3ec83f811b53a9d216fced969570a609">yajl_gen_map_close</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_start_array(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#d26cfe23a7967f9702eab0dabbbf51bf">yajl_gen_array_open</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> reformat_end_array(<span class="keywordtype">void</span> * ctx)
{
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g = (<a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a>) ctx;
    <a class="code" href="yajl__gen_8h.html#83e8d84da21a01e2c52534eef3350707">yajl_gen_array_close</a>(g);
    <span class="keywordflow">return</span> 1;
}

<span class="keyword">static</span> <a class="code" href="structyajl__callbacks.html">yajl_callbacks</a> callbacks = {
    reformat_null,
    reformat_boolean,
    NULL,
    NULL,
    reformat_number,
    reformat_string,
    reformat_start_map,
    reformat_map_key,
    reformat_end_map,
    reformat_start_array,
    reformat_end_array
};

<span class="keyword">static</span> <span class="keywordtype">void</span>
usage(<span class="keyword">const</span> <span class="keywordtype">char</span> * progname)
{
    fprintf(stderr, <span class="stringliteral">"usage:  %s &lt;filename&gt;\n"</span>
            <span class="stringliteral">"    -m minimize json rather than beautify (default)\n"</span>
            <span class="stringliteral">"    -u allow invalid UTF8 inside strings during parsing\n"</span>,
            progname);
    exit(1);

}

<span class="keywordtype">int</span> 
main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)
{
    <a class="code" href="yajl__parse_8h.html#cb85b92f3d7cb6f0743b4e68d0172323">yajl_handle</a> hand;
    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> fileData[65536];
    <span class="comment">/* generator config */</span>
    <a class="code" href="structyajl__gen__config.html">yajl_gen_config</a> conf = { 1, <span class="stringliteral">"  "</span> };
    <a class="code" href="yajl__gen_8h.html#497f7224309c1a0118f40c87e3fd3f65">yajl_gen</a> g;
    <a class="code" href="yajl__parse_8h.html#1d2bc7f4962c55436daaba61ffaf1f7d">yajl_status</a> stat;
    <span class="keywordtype">size_t</span> rd;
    <span class="comment">/* allow comments */</span>
    <a class="code" href="structyajl__parser__config.html">yajl_parser_config</a> cfg = { 1, 1 };
    <span class="keywordtype">int</span> done = 0;
    
    <span class="comment">/* check arguments.  We expect exactly one! */</span>
    <span class="keywordflow">if</span> (argc == 2) {
        <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">"-m"</span>, argv[1])) {
            conf.<a class="code" href="structyajl__gen__config.html#85437a875ae65161b4f28bac6ff89c99">beautify</a> = 0;

        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<span class="stringliteral">"-u"</span>, argv[1])) {
            cfg.<a class="code" href="structyajl__parser__config.html#33f7ab7fb27bf626441f15d649dea5d9">checkUTF8</a> = 0;
        } <span class="keywordflow">else</span> {
            usage(argv[0]);
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc != 1) {
        usage(argv[0]);
    }
    
    g = <a class="code" href="yajl__gen_8h.html#59e48af8543bc366dac8b97353cbb379">yajl_gen_alloc</a>(&amp;conf, NULL);

    <span class="comment">/* ok.  open file.  let's read and parse */</span>
    hand = <a class="code" href="yajl__parse_8h.html#2cd939ef7b4b04a77330e8cb5d1e232f">yajl_alloc</a>(&amp;callbacks, &amp;cfg, NULL, (<span class="keywordtype">void</span> *) g);
        
    <span class="keywordflow">while</span> (!done) {
        rd = fread((<span class="keywordtype">void</span> *) fileData, 1, <span class="keyword">sizeof</span>(fileData) - 1, stdin);
        
        <span class="keywordflow">if</span> (rd == 0) {
            <span class="keywordflow">if</span> (!feof(stdin)) {
                fprintf(stderr, <span class="stringliteral">"error on file read.\n"</span>);
                <span class="keywordflow">break</span>;
            }
            done = 1;
        }
        fileData[rd] = 0;
        
        <span class="keywordflow">if</span> (done)
            <span class="comment">/* parse any remaining buffered data */</span>
            stat = <a class="code" href="yajl__parse_8h.html#c348460bb319bcbeb646b542bf150b93">yajl_parse_complete</a>(hand);
        <span class="keywordflow">else</span>
            <span class="comment">/* read file data, pass to parser */</span>
            stat = <a class="code" href="yajl__parse_8h.html#0b02b6a506f38eec9a9281ee89bff4ae">yajl_parse</a>(hand, fileData, rd);

        <span class="keywordflow">if</span> (stat != <a class="code" href="yajl__parse_8h.html#1d2bc7f4962c55436daaba61ffaf1f7d67a2a1b5d684de357adb0e1ea444ffd7">yajl_status_ok</a> &amp;&amp;
            stat != <a class="code" href="yajl__parse_8h.html#1d2bc7f4962c55436daaba61ffaf1f7d88c7cd7b308d09c32dad74b47b9ae3f4">yajl_status_insufficient_data</a>)
        {
            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * str = <a class="code" href="yajl__parse_8h.html#c25621056d7bb34d3094d824848a9856">yajl_get_error</a>(hand, 1, fileData, rd);
            fprintf(stderr, (<span class="keyword">const</span> <span class="keywordtype">char</span> *) str);
            <a class="code" href="yajl__parse_8h.html#ed4ff679c8ede798fda07293b554b401">yajl_free_error</a>(hand, str);
        } <span class="keywordflow">else</span> {
            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * buf;
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len;
            <a class="code" href="yajl__gen_8h.html#55417a9babe516e9e9969d28bc908d1b">yajl_gen_get_buf</a>(g, &amp;buf, &amp;len);
            fwrite(buf, 1, len, stdout);
            <a class="code" href="yajl__gen_8h.html#2942e3562a54d1df13a158fcfd38bd37">yajl_gen_clear</a>(g);
        }
    }

    <a class="code" href="yajl__gen_8h.html#cb19f820b9e4862b925e7b9f75f29476">yajl_gen_free</a>(g);
    <a class="code" href="yajl__parse_8h.html#38c2b4c1fb791750a8da39800f160cca">yajl_free</a>(hand);
    
    <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Apr 24 15:35:18 2009 for YAJL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
